<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booterspace | Professional Network</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .tab-active { color: #4f46e5; }
        .tab-active::after { content: ''; position: absolute; bottom: 0; left: 25%; right: 25%; height: 3px; background: #4f46e5; border-radius: 99px 99px 0 0; }
        .shimmer { background: linear-gradient(90deg, #f1f5f9 25%, #f8fafc 50%, #f1f5f9 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">

    <!-- Loading Overlay -->
    <div id="loading-screen" class="fixed inset-0 bg-white z-[100] flex items-center justify-center transition-opacity duration-500">
        <div class="flex flex-col items-center">
            <div class="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
            <p class="mt-4 text-slate-500 font-bold animate-pulse uppercase tracking-widest text-xs">Launching Booterspace...</p>
        </div>
    </div>

    <!-- Header & Navigation -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <button id="menu-toggle" class="md:hidden p-2 -ml-2 text-slate-600 hover:bg-slate-100 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <div class="bg-indigo-600 p-2 rounded-xl shadow-indigo-100 shadow-lg">
                    <svg class="text-white" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <span class="font-extrabold text-xl tracking-tight hidden xs:block">booterspace</span>
            </div>
            
            <div class="flex items-center gap-3" id="profile-trigger">
                <div class="hidden lg:block text-right">
                    <p id="user-name" class="text-sm font-bold text-slate-800">User</p>
                    <p class="text-[10px] text-green-500 font-bold uppercase tracking-wider flex items-center gap-1 justify-end">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Online
                    </p>
                </div>
                <img id="user-avatar" src="" class="w-10 h-10 rounded-full border-2 border-indigo-50 shadow-sm" alt="Me">
            </div>
        </div>

        <!-- Top Mobile Navigation (Tablet & Mobile only) -->
        <nav class="md:hidden bg-white border-b border-slate-100 flex items-center justify-around px-2 overflow-x-auto">
            <button onclick="setActiveTab('suggestions')" class="nav-btn-mobile flex-1 py-3 flex flex-col items-center gap-1 relative" data-tab="suggestions">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="22" y1="11" x2="16" y2="11"></line></svg>
                <span class="text-[10px] font-black uppercase">Discover</span>
            </button>
            <button onclick="setActiveTab('requests')" class="nav-btn-mobile flex-1 py-3 flex flex-col items-center gap-1 relative" data-tab="requests">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                <span class="text-[10px] font-black uppercase">Pending</span>
                <span id="badge-requests" class="hidden absolute top-2 right-1/4 translate-x-1/2 w-4 h-4 bg-red-500 text-white text-[9px] font-black rounded-full border border-white flex items-center justify-center">0</span>
            </button>
            <button onclick="setActiveTab('list')" class="nav-btn-mobile flex-1 py-3 flex flex-col items-center gap-1 relative" data-tab="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                <span class="text-[10px] font-black uppercase">Network</span>
            </button>
        </nav>
    </header>

    <!-- Side Drawer (Mobile Only) -->
    <div id="drawer" class="fixed inset-0 z-50 pointer-events-none md:hidden">
        <div id="drawer-overlay" class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300 pointer-events-none"></div>
        <div id="drawer-content" class="absolute left-0 top-0 bottom-0 w-72 bg-white -translate-x-full transition-transform duration-300 pointer-events-auto shadow-2xl flex flex-col">
            <div class="h-24 bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center px-6 justify-between">
                <span class="text-white font-bold text-lg">Booterspace Profile</span>
                <button id="drawer-close" class="text-white/80 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </div>
            <div class="p-6 -mt-10 flex flex-col items-center text-center">
                <img id="drawer-avatar" src="" class="w-20 h-20 rounded-full border-4 border-white bg-slate-100 shadow-lg mb-3">
                <h2 id="drawer-name" class="font-bold text-xl text-slate-800">...</h2>
                <p id="drawer-email" class="text-sm text-slate-500 mb-6">...</p>
                <div class="w-full h-px bg-slate-100 mb-6"></div>
                <div class="w-full text-left space-y-4">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Navigation</p>
                    <button onclick="setActiveTab('suggestions'); closeDrawer()" class="flex items-center gap-3 text-slate-600 font-bold hover:text-indigo-600"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="22" y1="11" x2="16" y2="11"></line></svg> Discover People</button>
                    <button onclick="setActiveTab('list'); closeDrawer()" class="flex items-center gap-3 text-slate-600 font-bold hover:text-indigo-600"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg> My Connections</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 pt-6 md:pt-10 grid grid-cols-1 md:grid-cols-12 gap-8 mb-20">
        
        <!-- Sidebar Navigation (Desktop Only) -->
        <aside class="hidden md:block col-span-4 lg:col-span-3 space-y-6">
            <div class="bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm">
                <div class="h-20 bg-gradient-to-br from-indigo-600 to-purple-600"></div>
                <div class="p-6 -mt-12 flex flex-col items-center">
                    <img id="side-avatar" src="" class="w-20 h-20 rounded-full border-4 border-white bg-white shadow-lg mb-3">
                    <h2 id="side-name" class="font-bold text-lg text-slate-800">...</h2>
                    <p id="side-email" class="text-xs text-slate-500 mb-4 truncate w-full text-center">...</p>
                    <div class="w-full grid grid-cols-2 gap-4 border-t border-slate-100 pt-5">
                        <div class="text-center">
                            <p id="stat-network" class="text-lg font-black text-indigo-600">0</p>
                            <p class="text-[9px] uppercase tracking-widest text-slate-400 font-bold">Network</p>
                        </div>
                        <div class="text-center border-l border-slate-100">
                            <p id="stat-pending" class="text-lg font-black text-indigo-600">0</p>
                            <p class="text-[9px] uppercase tracking-widest text-slate-400 font-bold">Requests</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white border border-slate-200 rounded-2xl p-2 shadow-sm space-y-1">
                <button onclick="setActiveTab('suggestions')" class="desktop-nav-btn w-full flex items-center justify-between p-4 rounded-xl text-sm font-bold transition-all text-slate-600 hover:bg-slate-50" data-tab="suggestions">
                    <div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="22" y1="11" x2="16" y2="11"></line></svg> Discover</div>
                </button>
                <button onclick="setActiveTab('requests')" class="desktop-nav-btn w-full flex items-center justify-between p-4 rounded-xl text-sm font-bold transition-all text-slate-600 hover:bg-slate-50" data-tab="requests">
                    <div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Invitations</div>
                    <span id="side-badge-requests" class="hidden px-2 py-0.5 rounded-lg bg-red-500 text-white text-[10px] font-black">0</span>
                </button>
                <button onclick="setActiveTab('list')" class="desktop-nav-btn w-full flex items-center justify-between p-4 rounded-xl text-sm font-bold transition-all text-slate-600 hover:bg-slate-50" data-tab="list">
                    <div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg> My Network</div>
                </button>
            </div>
        </aside>

        <!-- Dynamic Content -->
        <div class="md:col-span-8 lg:col-span-9 space-y-6">
            
            <div id="hero-banner" class="bg-indigo-900 rounded-3xl p-8 text-white shadow-xl relative overflow-hidden min-h-[160px] flex flex-col justify-center">
                <div class="relative z-10">
                    <h1 id="tab-title" class="text-2xl md:text-3xl font-black mb-2 tracking-tight">Discover</h1>
                    <p id="tab-desc" class="text-indigo-200 text-sm md:text-base max-w-md opacity-90 italic">Welcome to Booterspace. Find and connect with professional peers globally.</p>
                </div>
                <div class="absolute -right-10 -bottom-10 w-48 h-48 bg-white/10 rounded-full blur-3xl"></div>
            </div>

            <div id="grid-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
                <!-- User cards injected here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden col-span-full py-20 px-6 text-center bg-white border border-dashed border-slate-300 rounded-3xl">
                <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="text-slate-300" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </div>
                <h3 class="text-lg font-bold text-slate-800">No members found</h3>
                <p class="text-slate-500 text-sm">Explore other parts of Booterspace or check back later.</p>
            </div>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto px-4 pb-10 text-center text-slate-400 text-[10px] uppercase tracking-widest font-bold">
        <p>&copy; 2024 booterspace network</p>
    </footer>

    <script>
        // --- Firebase Core Initialization ---
        const firebaseConfig = JSON.parse(__firebase_config);
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'booterspace-chat';

        // --- State ---
        let currentUser = null;
        let activeTab = 'suggestions';
        let allUsers = [];
        let connectionRequests = [];

        // --- App Logic ---
        async function init() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await auth.signInWithCustomToken(__initial_auth_token);
                } else {
                    await auth.signInAnonymously();
                }
            } catch (err) { console.error("Auth error:", err); }

            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    await syncProfile(user);
                    setupListeners();
                }
            });
        }

        async function syncProfile(user) {
            const userRef = db.doc(`users/${user.uid}`);
            const snap = await userRef.get();
            const avatar = `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.uid}`;
            
            if (!snap.exists) {
                await userRef.set({
                    displayName: user.displayName || `Member_${user.uid.slice(0, 4)}`,
                    email: user.email || 'user@booterspace.io',
                    avatar: avatar,
                    headline: 'Visionary Networker',
                    joinedAt: Date.now()
                });
            }

            // Update Header UI
            document.getElementById('user-name').innerText = user.displayName || 'Member';
            document.getElementById('user-avatar').src = avatar;
            document.getElementById('side-avatar').src = avatar;
            document.getElementById('drawer-avatar').src = avatar;
            document.getElementById('side-name').innerText = user.displayName || 'Member';
            document.getElementById('drawer-name').innerText = user.displayName || 'Member';
            document.getElementById('side-email').innerText = user.email || 'Welcome to Booterspace';
            document.getElementById('drawer-email').innerText = user.email || 'Welcome to Booterspace';
        }

        function setupListeners() {
            if (!currentUser) return;

            // Listen for all users
            db.collection('users').onSnapshot(snap => {
                allUsers = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            }, err => console.error("Users error:", err));

            // Listen for incoming + outgoing connection requests allowed by rules
            const reqCol = db.collection(`artifacts/${appId}/public/data/connection_requests`);
            const requestMap = new Map();

            const syncRequests = (snap) => {
                snap.docChanges().forEach((change) => {
                    if (change.type === 'removed') requestMap.delete(change.doc.id);
                    else requestMap.set(change.doc.id, { id: change.doc.id, ...change.doc.data() });
                });
                connectionRequests = Array.from(requestMap.values());
                updateBadges();
                render();
            };

            reqCol.where('fromId', '==', currentUser.uid).onSnapshot(syncRequests, err => console.error("Conn error:", err));
            reqCol.where('toId', '==', currentUser.uid).onSnapshot(syncRequests, err => console.error("Conn error:", err));

            // Done loading
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('opacity-0');
                setTimeout(() => document.getElementById('loading-screen').remove(), 500);
            }, 800);
        }

        function updateBadges() {
            const incoming = connectionRequests.filter(c => c.toId === currentUser.uid && c.status === 'pending').length;
            const myCount = connectionRequests.filter(c => c.status === 'accepted').length;

            const badgeTop = document.getElementById('badge-requests');
            const badgeSide = document.getElementById('side-badge-requests');
            
            if (incoming > 0) {
                badgeTop.innerText = incoming;
                badgeSide.innerText = incoming;
                badgeTop.classList.remove('hidden');
                badgeSide.classList.remove('hidden');
            } else {
                badgeTop.classList.add('hidden');
                badgeSide.classList.add('hidden');
            }

            document.getElementById('stat-network').innerText = myCount;
            document.getElementById('stat-pending').innerText = incoming;
        }

        function setActiveTab(tab) {
            activeTab = tab;
            
            // Update UI Active States
            document.querySelectorAll('[data-tab]').forEach(el => {
                const isMatch = el.getAttribute('data-tab') === tab;
                if (isMatch) {
                    el.classList.add('tab-active', 'bg-indigo-600', 'text-white', 'shadow-md');
                    el.classList.remove('text-slate-600', 'hover:bg-slate-50');
                } else {
                    el.classList.remove('tab-active', 'bg-indigo-600', 'text-white', 'shadow-md');
                    el.classList.add('text-slate-600', 'hover:bg-slate-50');
                }
            });

            // Update Hero
            const titles = { suggestions: 'Discover People', requests: 'Invitations', list: 'My Network' };
            const descs = { 
                suggestions: 'Grow your reach on Booterspace by connecting with industry experts.', 
                requests: 'Manage incoming and outgoing connection requests.', 
                list: 'Keep track of your established professional relationships.'
            };
            document.getElementById('tab-title').innerText = titles[tab];
            document.getElementById('tab-desc').innerText = descs[tab];

            render();
        }

        function render() {
            const container = document.getElementById('grid-container');
            const empty = document.getElementById('empty-state');
            container.innerHTML = '';
            
            const acceptedIds = connectionRequests.filter(c => c.status === 'accepted')
                .map(c => c.fromId === currentUser.uid ? c.toId : c.fromId);

            let displayList = [];

            if (activeTab === 'suggestions') {
                displayList = allUsers.filter(u => 
                    u.id !== currentUser.uid && 
                    !acceptedIds.includes(u.id) &&
                    !connectionRequests.some(c => c.fromId === u.id || c.toId === u.id)
                ).map(u => ({ ...u, type: 'suggestion' }));
            } 
            else if (activeTab === 'list') {
                displayList = allUsers.filter(u => acceptedIds.includes(u.id))
                    .map(u => ({ ...u, type: 'connected' }));
            }
            else if (activeTab === 'requests') {
                const incoming = connectionRequests.filter(c => c.toId === currentUser.uid && c.status === 'pending');
                const outgoing = connectionRequests.filter(c => c.fromId === currentUser.uid && c.status === 'pending');
                
                incoming.forEach(c => {
                    const u = allUsers.find(usr => usr.id === c.fromId);
                    if (u) displayList.push({ ...u, type: 'incoming', requestId: c.id, fromId: c.fromId });
                });
                outgoing.forEach(c => {
                    const u = allUsers.find(usr => usr.id === c.toId);
                    if (u) displayList.push({ ...u, type: 'outgoing', requestId: c.id });
                });
            }

            if (displayList.length === 0) {
                empty.classList.remove('hidden');
            } else {
                empty.classList.add('hidden');
                displayList.forEach(u => container.appendChild(createUserCard(u)));
            }
        }

        function createUserCard(u) {
            const div = document.createElement('div');
            div.className = "bg-white border border-slate-200 rounded-2xl p-5 flex flex-col items-center text-center shadow-sm hover:shadow-md transition-all";
            
            const actionBtn = getActionButton(u);

            div.innerHTML = `
                <div class="relative mb-4">
                    <img src="${u.photoURL || u.avatar || `https://api.dicebear.com/7.x/avataaars/svg?seed=${u.id}`}" class="w-20 h-20 rounded-full bg-slate-50 border-2 border-slate-100">
                    ${u.type === 'connected' ? '<div class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>' : ''}
                </div>
                <h4 class="font-bold text-slate-800 truncate w-full">${u.fullName || u.displayName || 'Member'}</h4>
                <p class="text-[10px] text-slate-400 font-black uppercase tracking-widest mt-1">${u.headline || 'Booterspace Pro'}</p>
                <div class="w-full mt-6 pt-4 border-t border-slate-50">
                    ${actionBtn}
                </div>
            `;
            return div;
        }

        function getActionButton(u) {
            if (u.type === 'suggestion') {
                return `<button onclick="handleAction('connect', '${u.id}')" class="w-full bg-indigo-600 text-white py-2.5 rounded-xl text-xs font-bold hover:bg-indigo-700 transition-colors">Connect</button>`;
            }
            if (u.type === 'incoming') {
                return `
                    <div class="flex gap-2">
                        <button onclick="handleAction('accept', '${u.requestId}')" class="flex-1 bg-indigo-600 text-white py-2.5 rounded-xl text-xs font-bold">Accept</button>
                        <button onclick="handleAction('reject', '${u.requestId}')" class="px-3 bg-slate-100 text-slate-500 py-2.5 rounded-xl text-xs font-bold">Ignore</button>
                    </div>
                `;
            }
            if (u.type === 'outgoing') {
                return `<button disabled class="w-full bg-slate-100 text-slate-400 py-2.5 rounded-xl text-xs font-bold cursor-not-allowed">Request Sent</button>`;
            }
            if (u.type === 'connected') {
                return `<button onclick="window.location.href='messages.html?composeTo=${encodeURIComponent(u.id)}'" class="w-full border border-slate-200 text-slate-500 py-2.5 rounded-xl text-xs font-bold hover:bg-indigo-50 hover:text-indigo-600 hover:border-indigo-100 transition-all">Message</button>`;
            }
            return '';
        }

        async function handleAction(type, id) {
            if (!currentUser) return;
            
            if (type === 'connect') {
                await db.doc(`artifacts/${appId}/public/data/connection_requests/${currentUser.uid}_${id}`).set({
                    fromId: currentUser.uid,
                    toId: id,
                    fromName: currentUser.displayName || 'User',
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } else if (type === 'accept') {
                await db.doc(`artifacts/${appId}/public/data/connection_requests/${id}`).update({ status: 'accepted' });
            } else if (type === 'reject') {
                await db.doc(`artifacts/${appId}/public/data/connection_requests/${id}`).update({ status: 'rejected' });
            }
        }

        // --- Drawer Logic ---
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('drawer-overlay');
        const content = document.getElementById('drawer-content');
        
        function openDrawer() {
            drawer.classList.remove('pointer-events-none');
            overlay.classList.remove('pointer-events-none');
            overlay.classList.add('opacity-100');
            content.classList.remove('-translate-x-full');
        }

        function closeDrawer() {
            overlay.classList.add('pointer-events-none');
            overlay.classList.remove('opacity-100');
            content.classList.add('-translate-x-full');
            setTimeout(() => drawer.classList.add('pointer-events-none'), 300);
        }

        document.getElementById('menu-toggle').addEventListener('click', openDrawer);
        document.getElementById('drawer-close').addEventListener('click', closeDrawer);
        overlay.addEventListener('click', closeDrawer);

        // Start App
        init();
        setActiveTab('suggestions');
    </script>
</body>
</html>
