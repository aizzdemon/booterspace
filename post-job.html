<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Post a Job - KARDAN</title>
  <meta name="description" content="Publish job openings from your organization and reach qualified candidates on BooterSpace.">
  <meta name="keywords" content="BooterSpace, jobs, careers, government jobs, community, networking">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://aizzdemon.github.io/booterspace/post-job.html">

  <meta property="og:type" content="website">
  <meta property="og:site_name" content="BooterSpace">
  <meta property="og:title" content="Post a Job - KARDAN">
  <meta property="og:description" content="Publish job openings from your organization and reach qualified candidates on BooterSpace.">
  <meta property="og:url" content="https://aizzdemon.github.io/booterspace/post-job.html">
  <meta property="og:image" content="https://aizzdemon.github.io/booterspace/assets/images/booterspace.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Post a Job - KARDAN">
  <meta name="twitter:description" content="Publish job openings from your organization and reach qualified candidates on BooterSpace.">
  <meta name="twitter:image" content="https://aizzdemon.github.io/booterspace/assets/images/booterspace.png">

  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Post a Job - KARDAN",
  "description": "Publish job openings from your organization and reach qualified candidates on BooterSpace.",
  "url": "https://aizzdemon.github.io/booterspace/post-job.html",
  "isPartOf": {
    "@type": "WebSite",
    "name": "BooterSpace",
    "url": "https://aizzdemon.github.io/booterspace/"
  }
}
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2563eb">
<link rel="stylesheet" href="assets/css/shared.css">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-gray-100 min-h-screen page-post-job">

<!-- HEADER -->
<header>
  <div class="logo-box">KARDAN</div>

  <h1 class="text-2xl font-bold text-center mt-6">Post a Job</h1>

  <nav class="mt-4 text-center space-x-2">
    <a href="index.html" class="nav-button"><i class="fas fa-home"></i> Home</a>
    <a href="jobs.html" class="nav-button"><i class="fas fa-briefcase"></i> Jobs</a>
    <a href="companies.html" class="nav-button"><i class="fas fa-building"></i> Companies</a>
    <a href="profile.html" class="nav-button"><i class="fas fa-user"></i> Profile</a>
  </nav>
</header>

<!-- FORM -->
<div class="max-w-md mx-auto mt-8 bg-white p-6 rounded shadow">
  <form id="jobForm" class="space-y-4">

    <input id="jobTitle" type="text" placeholder="Job Title" class="w-full px-3 py-2 border rounded" required>

    <input id="companyName" type="text" placeholder="Company Name" class="w-full px-3 py-2 border rounded" required>

    <input id="companyWebsite" type="url" placeholder="Company Website (optional)" class="w-full px-3 py-2 border rounded">

    <input id="companyLogo" type="url" placeholder="Company Logo URL (optional)" class="w-full px-3 py-2 border rounded">

    <input id="jobPlace" type="text" placeholder="Location" class="w-full px-3 py-2 border rounded" required>

    <input id="salary" type="text" placeholder="Salary (optional)" class="w-full px-3 py-2 border rounded">

    <input id="jobLink" type="url" placeholder="Application Link" class="w-full px-3 py-2 border rounded" required>

    <textarea id="jobDescription" rows="3" placeholder="Job Description" class="w-full px-3 py-2 border rounded" required></textarea>

    <button type="submit" class="w-full bg-green-600 text-white font-bold py-2 rounded hover:bg-green-700">
      Publish Job
    </button>
  </form>

  <p id="successMessage" class="hidden mt-3 text-green-600 font-semibold">
    ✅ Job successfully posted (Pending Admin Approval)
  </p>
</div>

<!-- SCRIPT -->
<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
    authDomain: "kar-kardan.firebaseapp.com",
    projectId: "kar-kardan",
    storageBucket: "kar-kardan.appspot.com",
    messagingSenderId: "554147696994",
    appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
    } else {
      alert("You must be logged in to post a job.");
      window.location.href = "login.html";
    }
  });

  document.getElementById("jobForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!currentUser) return;

    try {
      const createdJob = {
        userId: currentUser.uid,              // ✅ REQUIRED BY RULE
        title: jobTitle.value.trim(),
        company: companyName.value.trim(),
        companyWebsite: companyWebsite.value.trim() || null,
        logoUrl: companyLogo.value.trim() || null,
        location: jobPlace.value.trim(),
        salary: salary.value.trim() || null,
        applyLink: jobLink.value.trim(),
        about: jobDescription.value.trim(),
        postedBy: currentUser.email,
        status: "pending",                    // ✅ REQUIRED BY RULE
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        likes: 0,
        dislikes: 0
      };

      const createdJobRef = await db.collection("jobs").add(createdJob);
      const createdJobId = createdJobRef.id;

      const usersSnap = await db.collection("users").get();
      const senderLabel = currentUser.displayName || currentUser.email || "A company";
      const notificationText = `New job posted: ${createdJob.title} at ${createdJob.company} by ${senderLabel}.`;

      const notifyTasks = usersSnap.docs
        .filter((u) => u.id !== currentUser.uid)
        .map((u) => db.collection("notifications").add({
          toUid: u.id,
          fromUid: currentUser.uid,
          type: "job_posted",
          message: notificationText,
          link: `job-detail.html?id=${encodeURIComponent(createdJobId)}`,
          read: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }));

      await Promise.all(notifyTasks);

      document.getElementById("successMessage").classList.remove("hidden");
      document.getElementById("jobForm").reset();

    } catch (err) {
      console.error(err);
      alert("❌ Failed to post job. Check console.");
    }
  });
</script>

</body>
</html>
