<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BooterSpace Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-slate-100">

<!-- LOGIN -->
<div id="loginBox" class="min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-xl shadow w-full max-w-md">
    <h2 class="text-2xl font-black text-center text-indigo-600 mb-6">
      BooterSpace Admin
    </h2>
    <input id="email" class="w-full p-3 border rounded mb-3" placeholder="Email">
    <input id="password" type="password" class="w-full p-3 border rounded mb-4" placeholder="Password">
    <button onclick="login()" class="w-full bg-indigo-600 text-white py-3 rounded font-bold">
      Login
    </button>
    <p id="loginErr" class="text-red-500 text-center mt-2"></p>
  </div>
</div>

<!-- ADMIN -->
<div id="adminBox" class="hidden">

<header class="bg-white shadow px-6 py-4 flex justify-between">
  <h1 class="font-black text-indigo-600">BooterSpace ADMIN</h1>
  <button onclick="logout()" class="text-red-600 font-bold">Logout</button>
</header>

<main class="max-w-6xl mx-auto p-6">

<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
  <button class="tabBtn" onclick="openTab('pending')">‚è≥ Pending Jobs</button>
  <button class="tabBtn" onclick="openTab('approved')">‚úÖ Approved Jobs</button>
  <button class="tabBtn bg-indigo-600 text-white" onclick="openTab('post')">‚ûï Post Job</button>
  <button class="tabBtn">üë• Users</button>
</div>

<div id="content" class="bg-white p-6 rounded-xl shadow min-h-[300px]">
  <p class="text-slate-400 text-center">Select option</p>
</div>

</main>
</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "PASTE_FIREBASE_API_KEY_HERE",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
});

const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_UID = "PASTE_ADMIN_UID_HERE";

/* ================= AUTH ================= */
function login() {
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(err => loginErr.innerText = err.message);
}

function logout() {
  auth.signOut();
}

auth.onAuthStateChanged(user => {
  const isAdmin = user && user.uid === ADMIN_UID;
  loginBox.classList.toggle("hidden", isAdmin);
  adminBox.classList.toggle("hidden", !isAdmin);
});

/* ================= TABS ================= */
function openTab(tab) {
  if (tab === "post") renderPostJob();
  if (tab === "pending") loadJobs("pending");
  if (tab === "approved") loadJobs("approved");
}

/* ================= POST JOB ================= */
function renderPostJob() {
  content.innerHTML = `
    <h2 class="text-xl font-bold mb-4">Post New Job (Pending)</h2>

    <form id="jobForm" class="space-y-3 max-w-xl">
      <input id="title" class="w-full p-3 border rounded" placeholder="Job Title" required>
      <input id="company" class="w-full p-3 border rounded" placeholder="Company" required>
      <input id="location" class="w-full p-3 border rounded" placeholder="Location" required>
      <input id="applyLink" class="w-full p-3 border rounded" placeholder="Apply Link" required>
      <textarea id="about" class="w-full p-3 border rounded" rows="4" placeholder="Job Description" required></textarea>

      <button class="bg-indigo-600 text-white px-6 py-3 rounded font-bold">
        Submit for Approval
      </button>

      <p id="successMsg" class="hidden text-green-600 font-bold">
        ‚úÖ Job submitted to pending list
      </p>
    </form>
  `;

  jobForm.onsubmit = submitJob;
}

async function submitJob(e) {
  e.preventDefault();

  const jobRef = await db.collection("jobs").add({
    title: title.value,
    company: company.value,
    location: location.value,
    applyLink: applyLink.value,
    about: about.value,
    status: "pending",          // üî¥ NOT APPROVED
    postedBy: "Admin",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  await db.collection("notifications").add({
    title: "New Job Submitted üïí",
    message: `${title.value} at ${company.value}`,
    link: `/job/${jobRef.id}`,
    read: false,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  sendPush(title.value, company.value);

  successMsg.classList.remove("hidden");
  jobForm.reset();
}

/* ================= LOAD JOBS ================= */
async function loadJobs(status) {
  content.innerHTML = `<h2 class="text-xl font-bold mb-4">${status.toUpperCase()} JOBS</h2>`;

  const snap = await db.collection("jobs").where("status", "==", status).get();

  if (snap.empty) {
    content.innerHTML += `<p class="text-slate-400">No jobs found</p>`;
    return;
  }

  snap.forEach(doc => {
    const j = doc.data();
    content.innerHTML += `
      <div class="border p-4 rounded mb-3">
        <h3 class="font-bold">${j.title}</h3>
        <p class="text-sm">${j.company} ‚Ä¢ ${j.location}</p>
      </div>
    `;
  });
}

/* ================= ONESIGNAL ================= */
function sendPush(title, company) {
  fetch("https://onesignal.com/api/v1/notifications", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Basic PASTE_ONESIGNAL_REST_API_KEY"
    },
    body: JSON.stringify({
      app_id: "PASTE_ONESIGNAL_APP_ID",
      included_segments: ["Subscribed Users"],
      headings: { en: "New Job Submitted üïí" },
      contents: { en: `${title} at ${company}` }
    })
  });
}
</script>

<style>
.tabBtn {
  background: white;
  border: 1px solid #e5e7eb;
  padding: 12px;
  border-radius: 12px;
  font-weight: bold;
}
</style>

</body>
</html>
