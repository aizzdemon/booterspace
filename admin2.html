<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Firestore Tabs + Calendar + Edit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore, collection, onSnapshot,
      query, where, updateDoc, doc, Timestamp
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // ðŸ”‘ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
      authDomain: "kar-kardan.firebaseapp.com",
      projectId: "kar-kardan"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allUsers = [];
    let currentTab = "all";

    // DOM
    const userList = document.getElementById("userList");
    const dateFilter = document.getElementById("dateFilter");

    // ðŸ” REAL-TIME LISTENER
    onSnapshot(collection(db, "users"), (snapshot) => {
      allUsers = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));

      updateCounts();
      renderList();
    });

    // ðŸ”¢ Update tab counts
    function updateCounts() {
      document.getElementById("allCount").innerText = allUsers.length;
      document.getElementById("activeCount").innerText = allUsers.filter(u => u.status === "active").length;
      document.getElementById("pendingCount").innerText = allUsers.filter(u => u.status === "pending").length;
      document.getElementById("blockedCount").innerText = allUsers.filter(u => u.status === "blocked").length;
    }

    // ðŸ“… Date filter helper
    function filterByDate(users) {
      if (!dateFilter.value) return users;

      const selectedDate = new Date(dateFilter.value);
      selectedDate.setHours(0,0,0,0);

      return users.filter(u => {
        const userDate = u.createdAt.toDate();
        userDate.setHours(0,0,0,0);
        return userDate.getTime() === selectedDate.getTime();
      });
    }

    // ðŸ“‹ Render list
    function renderList() {
      userList.innerHTML = "";

      let users = allUsers;
      if (currentTab !== "all") {
        users = users.filter(u => u.status === currentTab);
      }

      users = filterByDate(users);

      if (users.length === 0) {
        userList.innerHTML = "<p class='text-gray-500'>No users found</p>";
        return;
      }

      users.forEach(user => {
        const div = document.createElement("div");
        div.className = "border p-3 rounded flex justify-between items-center";

        div.innerHTML = `
          <div>
            <p class="font-semibold">${user.name}</p>
            <p class="text-sm text-gray-500">${user.status}</p>
          </div>

          <button
            class="px-3 py-1 text-sm bg-blue-600 text-white rounded"
            onclick="editUser('${user.id}', '${user.status}')">
            Edit
          </button>
        `;

        userList.appendChild(div);
      });
    }

    // âœï¸ Edit user
    window.editUser = async (id, currentStatus) => {
      const newStatus = prompt(
        "Update status (active / pending / blocked):",
        currentStatus
      );

      if (!newStatus) return;

      await updateDoc(doc(db, "users", id), {
        status: newStatus
      });

      alert("User updated âœ”");
    };

    // ðŸ“Œ Tab switch
    window.showTab = (tab) => {
      currentTab = tab;
      renderList();
    };

    // ðŸ“… Date change
    dateFilter.addEventListener("change", renderList);
  </script>
</head>

<body class="bg-gray-100 p-6">
  <!-- Navbar -->
  <div id="navbar"></div>
  <script>
  fetch("navbar.html").then(r=>r.text()).then(html=>{
    document.getElementById("navbar").innerHTML=html;
    const s=document.createElement("script");
    s.type="module"; 
    s.src="navbar.js"; 
    document.body.appendChild(s);
  });
  </script>


  <!-- Tabs -->
  <div class="flex gap-3 mb-4">
    <button onclick="showTab('all')" class="flex gap-2 px-4 py-2 border rounded bg-white">
      All <span id="allCount" class="bg-blue-600 text-white px-2 rounded-full text-xs">0</span>
    </button>

    <button onclick="showTab('active')" class="flex gap-2 px-4 py-2 border rounded bg-white">
      Active <span id="activeCount" class="bg-green-600 text-white px-2 rounded-full text-xs">0</span>
    </button>

    <button onclick="showTab('pending')" class="flex gap-2 px-4 py-2 border rounded bg-white">
      Pending <span id="pendingCount" class="bg-yellow-500 text-white px-2 rounded-full text-xs">0</span>
    </button>

    <button onclick="showTab('blocked')" class="flex gap-2 px-4 py-2 border rounded bg-white">
      Blocked <span id="blockedCount" class="bg-red-600 text-white px-2 rounded-full text-xs">0</span>
    </button>
  </div>

  <!-- Date Filter -->
  <div class="mb-4">
    <input
      type="date"
      id="dateFilter"
      class="border px-3 py-2 rounded"
    />
  </div>

  <!-- User List -->
  <div id="userList" class="space-y-3 bg-white p-4 rounded shadow"></div>

</body>
</html>
